static const uint16_t init_chance[3][30][32]={
  {
    {34,8,797,865,1209,1061,1319,1069,1322,1164,1385,1405,1438,1470,1664,1686,1814,1726,608,624,85,8,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4062,3847,3694,3691,3597,3570,3545,3575,3596,3647,3697,3723,3772,3887,3886,3872,3725,3935,3981,3880,3738,4088,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4079,3805,3529,3485,3327,3329,3325,3387,3430,3487,3538,3590,3561,3747,3727,3831,3835,3891,3853,3844,3947,4088,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4016,3622,3205,3144,3009,3116,3134,3243,3265,3341,3326,3382,3380,3531,3543,3723,3640,3520,3507,3478,3349,3925,3584,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3982,3183,2624,2652,2655,2843,2843,2989,2964,3092,3029,3089,3071,3308,3120,3400,3260,3183,2984,3153,2448,3812,3072,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3743,2014,1578,1951,2002,2315,2287,2434,2407,2511,2398,2437,2446,2658,2618,2601,2490,2087,1540,2688,2179,2788,2926,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3425,787,831,1319,1255,1569,1547,1768,1703,1875,1826,1729,1508,1987,1828,2021,1899,1317,643,1715,1619,2124,1365,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3345,87,235,304,447,642,607,971,1110,1321,1039,1094,575,1017,963,1176,1004,8,8,853,1024,8,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,2239,1997,2089,1875,1925,2036,2057,2036,1825,1976,1919,2272,1826,1416,1620,905,2788,2779,683,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1986,2089,2136,1922,2081,2091,1838,2063,1992,1921,1964,2296,1644,1853,2215,907,2259,2017,1536,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2025,2023,2069,2049,2126,2077,1928,1762,2090,2267,2100,2074,2339,2011,2604,1592,1613,1655,1733,1365,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2028,2010,2119,2086,2129,2058,2007,1815,2290,2102,1894,1777,2073,2274,2300,2036,1804,1685,2176,759,8,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2158,2043,2056,2071,2051,2043,1851,1986,1905,1788,1617,1877,2121,2135,2033,1977,1807,1841,1853,768,683,1365,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2179,2106,2214,2114,2012,2096,1913,1881,1828,1680,1701,1972,1554,2033,1887,2314,1743,1654,2432,2048,819,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2039,2118,2148,2085,2038,1965,1789,1865,1549,1573,1783,1669,1535,1915,1487,1434,1212,2731,2560,4088,1365,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1838,2019,1990,1977,1973,1910,2001,1971,1898,2019,1974,2036,2018,1957,2018,2091,1864,1858,2173,1919,2210,2503,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1291,2087,1941,1937,1913,1799,1960,1986,2010,2048,2083,2054,2238,2209,2321,2145,2327,2281,2112,2114,2291,2276,2816,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3044,1902,1840,1813,1817,1867,1964,1957,2035,2075,2039,2068,1976,2108,2002,2258,2223,1903,2092,1794,1201,2503,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2577,2077,1633,1642,1686,1721,1881,1961,1920,2009,1981,1969,2004,2013,1937,1906,2155,1880,1974,1448,1536,1820,1170,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3072,1160,987,1235,1319,1324,1447,1559,1558,1650,1582,1781,1780,1510,1786,1445,1793,1632,2185,1286,1485,1365,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2231,573,510,767,781,964,1085,1108,1235,1150,1239,1274,1516,1086,1719,1370,1895,780,1638,683,2458,1365,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2511,270,276,349,138,513,562,883,1156,1052,1613,821,607,1441,1170,1365,1024,2048,2048,8,8,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048}
  },
  {
    {8,101,1087,1062,1510,1441,1738,1645,1752,1651,1658,1600,1547,1487,1526,1369,1597,1429,972,866,1152,455,1792,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,3352,3236,3434,3126,3091,3039,3064,3092,3146,3225,3199,3134,3332,3334,3411,3382,3041,3043,3241,3468,3243,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,3244,2928,2687,2227,2255,2243,2392,2415,2548,2585,2761,2747,2770,2918,3070,2637,2792,2700,2519,1936,2420,1024,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,3139,1979,1705,1577,1694,1773,1851,1920,2050,2178,2210,2307,2390,2488,2468,2123,2332,2549,2324,2351,3072,2731,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3872,1654,1412,1198,1304,1312,1293,1579,1448,1666,1636,1551,1823,1916,2079,2560,2028,1966,1845,2464,2321,1853,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2272,1022,1045,1160,1267,1406,1486,1547,1702,1742,1798,2011,1881,2138,2226,2238,1888,1674,1536,1595,1147,1536,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3968,454,537,652,731,798,805,926,974,1109,1065,1191,1355,1407,1578,1819,1008,1055,1073,585,683,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1974,59,150,151,274,214,180,282,330,549,333,380,542,514,878,1583,8,683,8,8,8,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {978,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1690,1913,1980,1971,2086,2117,2052,2125,2017,2143,2101,2096,2022,2149,2205,1423,1897,2825,3506,1707,1638,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1858,1803,1821,1760,1877,1959,1965,1963,1986,1946,1988,2067,1905,2044,2327,1901,1947,1681,2344,410,1365,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1685,1642,1528,1492,1600,1546,1738,1778,1626,1857,1520,1771,1666,1796,1891,2243,2218,2183,2731,2731,8,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1487,1550,1372,1500,1385,1383,1525,1493,1651,1386,1209,1301,1449,2178,1597,1778,1484,2604,2116,3004,819,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1559,1286,1266,1382,1294,1495,1410,1479,1346,1420,1408,1435,1258,1376,1522,1784,1815,2458,2091,1365,1365,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1191,1067,1112,1277,1148,962,1317,1291,1486,1391,1277,1399,1280,1813,1407,2513,1953,2731,2048,1365,8,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,315,506,416,670,611,412,693,558,732,717,678,738,630,1449,239,3277,1024,2731,8,4088,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,8,8,8,8,8,8,8,8,8,8,8,8,8,819,8,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1604,2055,1713,1820,1616,1682,1597,1724,1630,1798,1755,1769,1873,1839,1993,1558,1740,2096,1785,2118,1580,1303,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1536,1811,1723,1596,1393,1449,1500,1493,1468,1643,1698,1751,1782,1867,1707,1300,1661,1397,1478,1750,1896,1365,1365,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3277,1805,1326,1236,1195,1353,1295,1432,1349,1387,1389,1477,1496,1688,1737,1906,1399,1481,1432,1739,1638,1853,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2554,1258,1139,1252,1256,1376,1389,1430,1587,1542,1454,1664,1572,1724,1709,1722,1484,1304,1040,1936,737,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2944,1028,946,1160,1091,1356,1181,1375,1333,1432,1360,1434,1512,1652,2123,1482,1166,1055,975,1755,8,8,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3174,796,622,773,758,789,843,979,866,1178,1067,779,1123,1798,1767,1161,819,910,1365,8,8,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2243,895,549,638,579,191,455,648,386,1050,906,390,910,1434,1024,1638,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048}
  },
  {
    {8,61,1649,1607,1750,1865,2059,2166,2195,2159,2261,2294,2285,2268,2379,2211,2516,2083,2043,1888,2347,1877,1536,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,2920,2620,3074,2535,2345,2335,2264,2274,2274,2120,2340,2204,2549,2613,2566,2040,1905,2091,2035,1682,2560,2731,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,2407,1794,1627,1298,1473,1706,1504,1696,1837,1897,1937,1790,1872,1961,1757,2125,1872,2157,1960,2389,2185,1638,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,2018,1246,1397,1389,1213,1459,1330,1587,1554,1693,2161,1710,1690,1692,2128,2055,1623,1715,2129,2048,512,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3891,496,605,726,872,932,1032,1106,1050,1477,1160,1280,1797,1336,1683,1850,1888,2567,2224,1451,1365,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2458,315,270,399,433,554,482,608,799,606,509,985,1019,1028,1115,1197,1549,751,1451,683,8,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {4088,56,192,295,167,390,633,315,470,733,602,862,473,385,1003,1024,1280,683,8,8,2048,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,36,67,180,210,273,23,550,62,97,182,749,186,410,1024,8,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1280,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1770,1819,2029,1607,1394,1657,1782,1641,1981,1733,1719,1923,1817,1642,2415,1176,1721,1423,819,683,2731,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1944,1787,1481,1495,1706,1627,1575,1509,1506,1714,1866,1821,2236,1702,2029,1940,2162,3351,1877,1365,1024,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2051,1844,1674,1754,1309,1432,1596,1862,2073,1630,1641,1605,1458,1451,2118,2017,2665,1327,1229,1365,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1969,1762,1572,1528,1326,1534,1537,1306,1302,1529,1553,1731,2014,1620,2206,2120,2133,3755,512,8,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1535,1880,1393,1738,1390,1227,1616,1614,1483,1679,1268,1565,1693,1731,1997,1711,2633,2185,1365,4088,4088,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,1098,1090,1048,1461,1299,925,1943,1098,1330,1689,720,1607,2508,2444,2412,2048,2731,2731,2048,2048,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,8,8,8,2048,32,8,8,585,1365,1024,683,1365,8,8,2048,4088,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1138,1730,1738,1601,1538,1392,1352,1301,1353,1576,1499,1415,1704,1619,1440,1825,1235,1768,1788,1894,1707,956,2458,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2207,1323,1201,1160,1005,1069,1089,1071,1121,1049,1057,1156,1245,1173,1258,1183,1280,1873,1954,1686,1536,3072,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1536,1077,904,1011,1017,1122,1159,1278,1459,1341,1457,1389,1343,1705,1534,1251,1522,1218,1161,1536,683,4088,1024,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {973,886,1010,842,1110,800,991,887,1100,1044,1419,1286,1065,1269,1448,922,1572,1084,1621,455,8,8,4088,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3482,552,707,810,839,895,1097,1282,920,1138,1273,756,1658,1539,1226,1062,819,2048,1365,2731,2048,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {1638,2052,943,145,581,139,621,189,777,482,811,608,1396,8,8,8,8,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {3413,8,8,8,8,768,8,1229,8,8,8,241,8,8,8,2048,8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {8,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048},
    {2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048}
  }
};


void extra_ctx_init(coder_t *coder, int cutoff) {


for (int s=0; s<32; s++) {
  for (int c=0; c<3; c++) {
    for (int v=0; v<30; v++) {
      chs_init(&coder->ctx->diff[s][c].chs[v],clamp(init_chance[c][v][s],cutoff,4096-cutoff));
    }
  }
}

/*  fprintf(stderr,"const uint16_t init_chance[3][30][32]={\n");
  for (int c=0; c<3; c++) {
    fprintf(stderr, "  {\n");
    for (int v=0; v<30; v++) {
      fprintf(stderr,"    {");
      for (int s=0; s<32; s++) {
        fprintf(stderr,"%i",coder->ctx.diff[s][c].chs[v].chance);
        if (s<31) fprintf(stderr,",");
      }
      fprintf(stderr,"}");
      if (v<29) fprintf(stderr,",");
      fprintf(stderr,"\n");
    }
    fprintf(stderr,"  }");
    if (c<2) fprintf(stderr,",");
    fprintf(stderr,"\n");
  }
  fprintf(stderr,"};\n"); */

}
